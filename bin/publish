#!/bin/bash

echo "==== QSB zusammenbauen ===="
bin/build -userdoc

echo "==== Release erzeugen ===="

echo "Erzeuge Release-Verzeichnis..."
rm -rf Release &>/dev/null
mkdir -p Release/src
mkdir -p Release/bin
echo "Fertig!"

echo "Kopiere QSB-Dateien..."
cp var/qsb.lua Release/src/questsystembehavior.lua &>/dev/null
cp var/qsb_min.lua Release/src/questsystembehavior_min.lua &>/dev/null
cp qsb/default/globalscript.lua Release/src/mapscript.lua &>/dev/null
cp qsb/default/localscript.lua Release/src/localmapscript.lua &>/dev/null
echo "Fertig!"

echo "Dokumentation kopieren..."
cp -r qsb/doc Release/doc &>/dev/null
mkdir Release/guide &>/dev/null
cp hlp/*.pdf Release/guide &>/dev/null
cp hlp/readme.txt Release/start.txt &>/dev/null
echo "Fertig!"

echo "Beispiele kopieren..."
cp -r qsb/example Release/example &>/dev/null
echo "Fertig!"

echo "Kopiere Map Iconator..."
mkdir Release/bin/MapIconator &>/dev/null
cp -r bin/MapIconator.jar Release/bin/MapIconator/MapIconator.jar &>/dev/null
echo "Fertig!"

#echo "Siedelwood Cutscene Assistant kopieren..."
#cp -r "bin/Siedelwood Cutscene Assistant.jar" Release/bin/SiedelwoodCutsceneAssistant.jar &>/dev/null
#echo "Fertig!"

echo "Cutscene Maker kopieren..."
mkdir Release/bin/CutsceneMaker &>/dev/null
cp -r "bin/CutsceneMaker.jar" Release/bin/CutsceneMaker/CutsceneMaker.jar &>/dev/null
echo "Fertig!"

# echo "Graph Viz kopieren..."
# mkdir Release/bin/QuestToGraphViz &>/dev/null
# cp -r "app/QuestToGraphVizConverter/bin/QuestToGraphVizConverter.jar" Release/bin/QuestToGraphViz/QuestToGraphVizConverter.jar &>/dev/null
# cp -r "app/QuestToGraphVizConverter/bin/QuestToGraphVizStarter.exe" Release/bin/QuestToGraphViz/QuestToGraphVizStarter.exe &>/dev/null
# cp -r "app/QuestToGraphVizConverter/lua" Release/bin/QuestToGraphViz/lua &>/dev/null
# echo "Fertig!"

echo "Archiv zusammenstellen..."
zip -r Release/doc Release/guide Release/* &>/dev/null
mv Release/doc.zip var/Release.zip &>/dev/null
echo "Fertig!"

echo "Aufräumen..."
rm -rf Release
echo "Fertig!"

echo "Veröffentlichung abgeschlossen!"
